NAT vs Direct Server return 

client -- SLB -- Server

source ip/target ip
1.10.1.11/9.0.0.1 

once request reaches SLB, SLB changes target ip to real server ip 
1.10.1.11/172.12.1.1

real server handles request and return data to SLB via default router 
172.12.1.1/1.10.1.11

slb changes source ip to vip.
9.0.0.1/1.10.1.11

with direct server return. response data won't be handled by SLB. to achieve this, the same vip is configured on both SLB server and real server(s). as the same MAC can't be bind to more than one IPs, special lookback address
172.0.0.1 is utilised to caryy the same vip.

in this  case. data flow like below.
client -- SLB -- Server

source ip/target ip
1.10.1.11/9.0.0.1/mac address 00:00...abc

once request reaches SLB, SLB changes mac address to real server's mac address on layer 2. 
1.10.1.11/9.0.0.1/mac address 00:00...def
real server handles request and return data to client directly without using slb.
172.12.1.1/1.10.1.11

At layer 2, load balancing can distribute traffic among the machines on the same network. But, as we discussed,
it only routes traffic based on MAC addresses. 
It’s impossible to route traffic to another device on a different network using L2 load balancing.
There are many scenarios when this kind of load balancing is helpful. 
One such use case divides the bandwidth equally to all devices within the network.

In contrast, L3 load balancers operate at a higher level, making it possible to route traffic using IPv4 and IPv6
addresses. Organizations use them to distribute the load across different virtual machines. 
They ensure high availability and reliability by circulating requests among servers or VMs.

In contrast to L2 and L3 load balancers, L7 load balancers are software that operates at the application layer. Popular L7 load balancing tools include Nginx and HAProxy. Many of them are open source, making it easy to add SSL termination and implement new protocols like HTTP/3.

L7 load balancers can also use extra information available at the application layer to carry out complex and intelligent load balancing. They can read the content of incoming HTTP(S) and use that data to route the request directly to where it needs to go. Most L7 load balancers also can define rules and targets to achieve the expected routing.

The main disadvantage of L7 load balancers is that they usually act as proxies, 
so they must maintain two open connections: one to the machine that made the request and one to the target machine
that is serving the request. L2 and L3 load balancers, in comparison, simply forward packets to their destination.

![lb](packtrav-l2-vs-l3.gif)

Notice between each Router, the MAC address header is stripped and regenerated to get it to the next hop. The IP header generated by the first computer is only stripped off by the final computer, hence the IP header handled the “end to end” delivery, and each of the four different MAC headers involved in this animation handled the “hop to hop” delivery.

OSI Layer 4 – Transport
The Transport layer of the OSI model is responsible for distinguishing network streams.

At any given time on a user’s computer there might be an Internet browser open, while music is being streamed, while a messenger or chat app is running. Each of these applications are sending and receiving data from the Internet, and all that data is arriving in the form of 1’s and 0’s on to that computer’s NIC.

Something has to exist in order to distinguish which 1’s and 0’s belong to the messenger or the browser or the streaming music. That “something” is Layer 4:

Layer 4 accomplishes this by using an addressing scheme known as Port Numbers.

Specifically, two methods of distinguishing network streams exist. They are known as the Transmission Control Protocol (TCP), or the User Datagram Protocol (UDP).

Both TCP and UDP have 65,536 port numbers (each), and a unique application stream is identified by both a Source and Destination port (in combination with their Source and Destination IP address).

TCP and UDP employ different strategies in how data streams are transferred, and their distinction and inner workings are both fascinating and significant, but unfortunately they are outside the scope of this article series. They will be the topic of a future article or series.

To summarize, 
if Layer 2 is responsible for hop to hop delivery,
and Layer 3 is responsible for end to end delivery, 
it can be said that Layer 4 is responsible for service to service delivery.

Layer 4 will add a TCP header which would include a Source and Destination port
Layer 3 will add an IP header which would include a Source and Destination IP address
Layer 2 would add an Ethernet header which would include a Source and Destination MAC address

host
The term host is a generic term that implies any sort of end-device on the Internet. Any device which might be the original initiation of traffic or the final destination of traffic can be considered a host.

network
A Network is simply two or more connected devices — typically grouped together by similar purposes or physical location. A network can take many different forms, for example:

switch
A Switch is a network device whose primary purpose is to facilitate communication within networks.Switches operate at Layer 2 of the OSI model, which means they only look into each data-gram up to the Layer 2 header. The Layer 2 header contains information that enables hop to hop delivery, such as the Source and Destination MAC address.

A Switch operates by maintaining what is known as a MAC Address table. This is a table that maps MAC addresses of devices plugged into each switch port. A typical switch has many ports, from 24 to 48, up to 96, or more.

The MAC Address Table is populated by looking at the Source MAC address field of any received frames.

In order to forward the frame, the Switch will lookup the Destination MAC address in their MAC Address Table to determine what port to use.

If a Switch encounters a frame for which it does not know the location of the Destination MAC address, it simply duplicates and floods the frame out each switch port (except the port it was received on). This process will be examined more closely in another article in this series.

Router
A Router is a network device whose primary purpose is to facilitate communication between networks. Each interface on a router creates a network boundary.

Routers operate at Layer 3 of the OSI Model, which means they only look into each datagram up to the Layer 3 header. The Layer 3 header contains information that enables end to end delivery, such as the Source and Destination IP Address.








